{"ast":null,"code":"import _regeneratorRuntime from\"/home/oshimayamato/practice/matching/frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/home/oshimayamato/practice/matching/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/home/oshimayamato/practice/matching/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{Image}from'@mui/icons-material';import React,{useContext,useRef,useState}from'react';import\"./Share.css\";import{AuthContext}from\"../../state/AuthContext\";import axios from'axios';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function Share(){var PUBLIC_FOLDER=process.env.REACT_APP_PUBLIC_FOLDER;var _useContext=useContext(AuthContext),user=_useContext.user;var desc=useRef();var _useState=useState(null),_useState2=_slicedToArray(_useState,2),file=_useState2[0],setFile=_useState2[1];var handleSubmit=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(e){var newPost,data,fileName;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:e.preventDefault();newPost={userId:user._id,desc:desc.current.value};if(!file){_context.next=16;break;}//キーとバリューを合わせてデータとして持っておく\ndata=new FormData();//同じ画像がアップロードされることも考えられるので現在時刻を付与する\nfileName=Date.now()+file.name;data.append(\"name\",fileName);data.append(\"file\",file);newPost.img=fileName;_context.prev=8;_context.next=11;return axios.post(\"/upload\",data);case 11:_context.next=16;break;case 13:_context.prev=13;_context.t0=_context[\"catch\"](8);console.log(_context.t0);case 16:_context.prev=16;_context.next=19;return axios.post(\"/posts\",newPost);case 19:window.location.reload();_context.next=25;break;case 22:_context.prev=22;_context.t1=_context[\"catch\"](16);console.log(_context.t1);case 25:case\"end\":return _context.stop();}},_callee,null,[[8,13],[16,22]]);}));return function handleSubmit(_x){return _ref.apply(this,arguments);};}();return/*#__PURE__*/_jsx(\"div\",{className:\"share\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"shareWrapper\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"shareTop\",children:[/*#__PURE__*/_jsx(\"img\",{src:user.profilePicture?PUBLIC_FOLDER+user.profilePicture:PUBLIC_FOLDER+\"/person/noAvatar.png\",alt:\"\",className:\"shareProfileImg\"}),/*#__PURE__*/_jsx(\"textarea\",{cols:\"20\",rows:\"5\",className:\"shareInput\",placeholder:\"\\u6295\\u7A3F\\u5185\\u5BB9\",ref:desc})]}),/*#__PURE__*/_jsx(\"hr\",{className:\"shareHr\"}),/*#__PURE__*/_jsxs(\"form\",{className:\"shareButtons\",onSubmit:function onSubmit(e){return handleSubmit(e);},children:[/*#__PURE__*/_jsx(\"div\",{className:\"shareOptions\",children:/*#__PURE__*/_jsx(\"label\",{className:\"shareOption\",htmlFor:\"file\"})}),/*#__PURE__*/_jsx(\"button\",{className:\"shareButton\",type:\"submit\",children:\"\\u6295\\u7A3F\"})]})]})});}","map":{"version":3,"names":["Image","React","useContext","useRef","useState","AuthContext","axios","Share","PUBLIC_FOLDER","process","env","REACT_APP_PUBLIC_FOLDER","user","desc","file","setFile","handleSubmit","e","preventDefault","newPost","userId","_id","current","value","data","FormData","fileName","Date","now","name","append","img","post","console","log","window","location","reload","profilePicture"],"sources":["/home/oshimayamato/practice/matching/frontend/src/components/share/Share.jsx"],"sourcesContent":["import { Image } from '@mui/icons-material'\nimport React, { useContext, useRef, useState } from 'react'\nimport \"./Share.css\"\nimport { AuthContext } from \"../../state/AuthContext\";\nimport axios from 'axios';\n\nexport default function Share() {\n  const PUBLIC_FOLDER = process.env.REACT_APP_PUBLIC_FOLDER;\n\n  const { user } = useContext(AuthContext);\n  const desc = useRef();\n\n  const [file, setFile] = useState(null);\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n\n    const newPost = {\n      userId: user._id,\n      desc: desc.current.value,\n    };\n\n    if(file) {\n      //キーとバリューを合わせてデータとして持っておく\n      const data = new FormData();\n      //同じ画像がアップロードされることも考えられるので現在時刻を付与する\n      const fileName = Date.now() + file.name;\n      data.append(\"name\", fileName);\n      data.append(\"file\", file);\n      newPost.img = fileName;\n\n      try {\n        //画像アップロード\n        await axios.post(\"/upload\", data);\n      } catch(err) {\n        console.log(err);\n      }\n    }\n\n    try {\n      await axios.post(\"/posts\", newPost);\n      window.location.reload();\n    } catch(err) {\n      console.log(err);\n    }\n  }\n\n  return (\n    <div className=\"share\">\n      <div className=\"shareWrapper\">\n        <div className=\"shareTop\">\n          <img src={\n            user.profilePicture\n              ? PUBLIC_FOLDER + user.profilePicture\n              : PUBLIC_FOLDER + \"/person/noAvatar.png\"\n          }alt=\"\" className=\"shareProfileImg\" />\n          <textarea cols=\"20\" rows=\"5\" className=\"shareInput\" placeholder='投稿内容' ref={desc} ></textarea>\n        </div>\n        <hr className=\"shareHr\" />\n        <form className=\"shareButtons\" onSubmit={(e) => handleSubmit(e)}>\n          <div className=\"shareOptions\">\n            <label className=\"shareOption\" htmlFor=\"file\">\n              {/* <Image\n                className=\"shareIcon\" htmlColor='blue'\n                />\n              <span className=\"shareOptionText\">\n                写真\n              </span>\n              <input\n                 type=\"file\" \n                 id =\"file\" \n                 accept=\".png, .jpeg, .jpg\" \n                 style={{display: \"none\"}}\n                 onChange={(e) => setFile(e.target.files[0])}\n              /> */}\n            </label>\n          </div>\n          <button className=\"shareButton\" type=\"submit\">\n            投稿\n          </button>\n        </form>\n      </div>\n    </div>\n  )\n}\n"],"mappings":"yZAAA,OAASA,KAAK,KAAQ,qBAAqB,CAC3C,MAAOC,MAAK,EAAIC,UAAU,CAAEC,MAAM,CAAEC,QAAQ,KAAQ,OAAO,CAC3D,MAAO,aAAa,CACpB,OAASC,WAAW,KAAQ,yBAAyB,CACrD,MAAOC,MAAK,KAAM,OAAO,CAAC,wFAE1B,cAAe,SAASC,MAAK,EAAG,CAC9B,GAAMC,cAAa,CAAGC,OAAO,CAACC,GAAG,CAACC,uBAAuB,CAEzD,gBAAiBT,UAAU,CAACG,WAAW,CAAC,CAAhCO,IAAI,aAAJA,IAAI,CACZ,GAAMC,KAAI,CAAGV,MAAM,EAAE,CAErB,cAAwBC,QAAQ,CAAC,IAAI,CAAC,wCAA/BU,IAAI,eAAEC,OAAO,eAEpB,GAAMC,aAAY,4FAAG,iBAAOC,CAAC,6IAC3BA,CAAC,CAACC,cAAc,EAAE,CAEZC,OAAO,CAAG,CACdC,MAAM,CAAER,IAAI,CAACS,GAAG,CAChBR,IAAI,CAAEA,IAAI,CAACS,OAAO,CAACC,KACrB,CAAC,KAEET,IAAI,0BACL;AACMU,IAAI,CAAG,GAAIC,SAAQ,EAAE,CAC3B;AACMC,QAAQ,CAAGC,IAAI,CAACC,GAAG,EAAE,CAAGd,IAAI,CAACe,IAAI,CACvCL,IAAI,CAACM,MAAM,CAAC,MAAM,CAAEJ,QAAQ,CAAC,CAC7BF,IAAI,CAACM,MAAM,CAAC,MAAM,CAAEhB,IAAI,CAAC,CACzBK,OAAO,CAACY,GAAG,CAAGL,QAAQ,CAAC,uCAIfpB,MAAK,CAAC0B,IAAI,CAAC,SAAS,CAAER,IAAI,CAAC,0FAEjCS,OAAO,CAACC,GAAG,aAAK,CAAC,gDAKb5B,MAAK,CAAC0B,IAAI,CAAC,QAAQ,CAAEb,OAAO,CAAC,SACnCgB,MAAM,CAACC,QAAQ,CAACC,MAAM,EAAE,CAAC,kFAEzBJ,OAAO,CAACC,GAAG,aAAK,CAAC,4EAEpB,kBA/BKlB,aAAY,4CA+BjB,CAED,mBACE,YAAK,SAAS,CAAC,OAAO,uBACpB,aAAK,SAAS,CAAC,cAAc,wBAC3B,aAAK,SAAS,CAAC,UAAU,wBACvB,YAAK,GAAG,CACNJ,IAAI,CAAC0B,cAAc,CACf9B,aAAa,CAAGI,IAAI,CAAC0B,cAAc,CACnC9B,aAAa,CAAG,sBACrB,IAAG,CAAC,EAAE,CAAC,SAAS,CAAC,iBAAiB,EAAG,cACtC,iBAAU,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,SAAS,CAAC,YAAY,CAAC,WAAW,CAAC,0BAAM,CAAC,GAAG,CAAEK,IAAK,EAAa,GAC1F,cACN,WAAI,SAAS,CAAC,SAAS,EAAG,cAC1B,cAAM,SAAS,CAAC,cAAc,CAAC,QAAQ,CAAE,kBAACI,CAAC,QAAKD,aAAY,CAACC,CAAC,CAAC,EAAC,wBAC9D,YAAK,SAAS,CAAC,cAAc,uBAC3B,cAAO,SAAS,CAAC,aAAa,CAAC,OAAO,CAAC,MAAM,EAcrC,EACJ,cACN,eAAQ,SAAS,CAAC,aAAa,CAAC,IAAI,CAAC,QAAQ,UAAC,cAE9C,EAAS,GACJ,GACH,EACF,CAEV"},"metadata":{},"sourceType":"module","externalDependencies":[]}