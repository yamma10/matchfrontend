{"ast":null,"code":"import _regeneratorRuntime from\"/home/oshimayamato/practice/matching/frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/home/oshimayamato/practice/matching/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/home/oshimayamato/practice/matching/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useContext,useEffect,useState}from'react';import Post from'../post/Post';import Share from'../share/Share';import\"./Timeline.css\";import axios from\"axios\";import{AuthContext}from'../../state/AuthContext';import Pagination from\"react-paginate\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function Timeline(_ref){var username=_ref.username;var _useState=useState([]),_useState2=_slicedToArray(_useState,2),posts=_useState2[0],setPosts=_useState2[1];//現在のページ\nvar _useState3=useState(1),_useState4=_slicedToArray(_useState3,2),currentPage=_useState4[0],setCurrentPage=_useState4[1];//1ページあたりに表示される投稿数\nvar _useState5=useState(5),_useState6=_slicedToArray(_useState5,1),postsPerPage=_useState6[0];var _useContext=useContext(AuthContext),user=_useContext.user;//投稿をとってくる\nuseEffect(function(){var fetchPosts=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var response;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:if(!username){_context.next=6;break;}_context.next=3;return axios.get(\"/posts/profile/\".concat(username));case 3:_context.t0=_context.sent;_context.next=9;break;case 6:_context.next=8;return axios.get(\"/posts/timeline/\".concat(user._id));case 8:_context.t0=_context.sent;case 9:response=_context.t0;//ホームの場合\nsetPosts(response.data.sort(function(post1,post2){return new Date(post2.createdAt)-new Date(post1.createdAt);}));// console.log(posts)\ncase 11:case\"end\":return _context.stop();}},_callee);}));return function fetchPosts(){return _ref2.apply(this,arguments);};}();fetchPosts();},[username]);//usernameがあるとき・・・username==user.username\n//ないとき・・・typeがtrue\nvar judge=function judge(){if(username){if(username==user.username&&user.type){return true;}else{return false;}}else{if(user.type){return true;}else{return false;}}};// console.log(posts.length)\nvar handlePageChange=function handlePageChange(e){setCurrentPage(e.selected+1);};//現在のページに表示する投稿を取得する\n//現在のページの最後の投稿のインデックス\nvar indexOfLastPost=currentPage*postsPerPage;//現在のページの最初の投稿のインデックス\nvar indexOfFirstPost=indexOfLastPost-postsPerPage;//現在のページに表示する投稿の配列\nvar currentPosts=posts.slice(indexOfFirstPost,indexOfLastPost);return/*#__PURE__*/_jsxs(\"div\",{className:\"timeline\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"timelineWrapper\",children:[judge()?/*#__PURE__*/_jsx(Share,{}):\"\",currentPosts.map(function(post){return/*#__PURE__*/_jsx(Post,{post:post},post._id);})]}),posts.length?posts?/*#__PURE__*/_jsx(Pagination,{previousLabel:\"前のページ\",nextLabel:\"次のページ\",breakLabel:\"...\",breakClassName:\"break-me\",pageCount:Math.ceil(posts.length/postsPerPage),marginPagesDisplayed:2,pageRangeDisplayed:5,onPageChange:handlePageChange,containerClassName:\"pagination\",subContainerClassName:\"pages pagination\",activeClassName:\"active\"}):\"\":/*#__PURE__*/_jsx(\"p\",{children:\"\\u307E\\u3060\\u6295\\u7A3F\\u304C\\u3042\\u308A\\u307E\\u305B\\u3093\"})]});}","map":{"version":3,"names":["React","useContext","useEffect","useState","Post","Share","axios","AuthContext","Pagination","Timeline","username","posts","setPosts","currentPage","setCurrentPage","postsPerPage","user","fetchPosts","get","_id","response","data","sort","post1","post2","Date","createdAt","judge","type","handlePageChange","e","selected","indexOfLastPost","indexOfFirstPost","currentPosts","slice","map","post","length","Math","ceil"],"sources":["/home/oshimayamato/practice/matching/frontend/src/components/timeline/Timeline.jsx"],"sourcesContent":["import React, { useContext, useEffect, useState } from 'react'\nimport Post from '../post/Post';\nimport Share from '../share/Share';\nimport \"./Timeline.css\";\nimport axios from \"axios\"\nimport { AuthContext } from '../../state/AuthContext';\nimport Pagination from \"react-paginate\";\n\nexport default function Timeline({ username }) {\n  const [posts, setPosts] = useState([]);\n  //現在のページ\n  const [currentPage, setCurrentPage] = useState(1);\n  //1ページあたりに表示される投稿数\n  const [postsPerPage] = useState(5);\n\n  const { user } = useContext(AuthContext)\n  \n  //投稿をとってくる\n  useEffect(() => {\n    const fetchPosts = async () => {\n      const response = username \n      ? await axios.get(`/posts/profile/${username}`) //プロフィールの場合\n      : await axios.get(`/posts/timeline/${user._id}`);//ホームの場合\n      \n      setPosts(\n        response.data.sort((post1, post2) => {\n        return new Date(post2.createdAt) - new Date(post1.createdAt);\n      })\n      );\n      // console.log(posts)\n    };\n    fetchPosts();\n  }, [username]);\n\n  //usernameがあるとき・・・username==user.username\n  //ないとき・・・typeがtrue\n  const judge = () => {\n    if(username){\n      if(username==user.username && user.type) {\n        return true;\n      }else {\n        return false;\n      }\n    } else {\n      if(user.type){\n        return true;\n      } else {\n        return false;\n      }\n    }\n  }\n\n  // console.log(posts.length)\n\n  const handlePageChange = (e) => {\n    setCurrentPage(e.selected + 1);\n  }\n\n  //現在のページに表示する投稿を取得する\n\n  //現在のページの最後の投稿のインデックス\n  const indexOfLastPost = currentPage * postsPerPage;\n  //現在のページの最初の投稿のインデックス\n  const indexOfFirstPost = indexOfLastPost - postsPerPage;\n  //現在のページに表示する投稿の配列\n  const currentPosts = posts.slice(indexOfFirstPost,indexOfLastPost);\n\n  return (\n    <div className=\"timeline\">\n      \n      <div className=\"timelineWrapper\">\n        { judge()\n        ? <Share />\n        : \"\"\n        }\n        \n        {currentPosts.map((post) => (\n          <Post post={post} key={post._id} />))\n        }\n      </div>\n      {\n        posts.length\n        ? (posts \n          ? <Pagination\n          previousLabel={\"前のページ\"}\n          nextLabel={\"次のページ\"}\n          breakLabel={\"...\"}\n          breakClassName={\"break-me\"}\n          pageCount={Math.ceil(posts.length/postsPerPage)}\n          marginPagesDisplayed={2}\n          pageRangeDisplayed={5}\n          onPageChange={handlePageChange}\n          containerClassName={\"pagination\"}\n          subContainerClassName={\"pages pagination\"}\n          activeClassName={\"active\"}\n        />\n          : \"\"\n        )\n        : <p>まだ投稿がありません</p>\n      }\n      \n    </div>\n  )\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}