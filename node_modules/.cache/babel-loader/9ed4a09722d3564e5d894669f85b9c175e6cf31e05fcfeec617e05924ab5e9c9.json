{"ast":null,"code":"import _regeneratorRuntime from\"/home/oshimayamato/practice/matching/frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/home/oshimayamato/practice/matching/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/home/oshimayamato/practice/matching/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{Favorite,MoreVert}from'@mui/icons-material';import React,{useEffect,useState}from'react';import\"./Post.css\";import axios from\"axios\";import{format}from\"timeago.js\";import{Link,useNavigate}from'react-router-dom';import{useContext}from'react';import{AuthContext}from'../../state/AuthContext';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function Post(_ref){var post=_ref.post;var PUBLIC_FOLDER=process.env.REACT_APP_PUBLIC_FOLDER;var navigation=useNavigate();var _useState=useState(post.likes.length),_useState2=_slicedToArray(_useState,2),like=_useState2[0],setLike=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isLiked=_useState4[0],setIsLiked=_useState4[1];var _useState5=useState({}),_useState6=_slicedToArray(_useState5,2),user=_useState6[0],setUser=_useState6[1];//自分\nvar _useContext=useContext(AuthContext),loginUser=_useContext.user;useEffect(function(){var fetchUser=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var response;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.next=2;return axios.get(\"/users/teacher/\".concat(post.userId));case 2:response=_context.sent;// console.log(response)\nsetUser(response.data);case 4:case\"end\":return _context.stop();}},_callee);}));return function fetchUser(){return _ref2.apply(this,arguments);};}();fetchUser();},[]);var handleLike=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return axios.put(\"/posts/\".concat(post._id,\"/like\"),{userId:loginUser._id});case 3:_context2.next=7;break;case 5:_context2.prev=5;_context2.t0=_context2[\"catch\"](0);case 7:setLike(isLiked?like-1:like+1);setIsLiked(!isLiked);case 9:case\"end\":return _context2.stop();}},_callee2,null,[[0,5]]);}));return function handleLike(){return _ref3.apply(this,arguments);};}();var handleSubmit=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(){var createRoom,room,room_id;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1)switch(_context3.prev=_context3.next){case 0:_context3.prev=0;createRoom={student_id:loginUser._id,teacher_id:user._id,studentName:loginUser.username,teacherName:user.username};_context3.next=4;return axios.post(\"/message/room\",createRoom);case 4:room=_context3.sent;room_id=room.data._id;navigation(\"/rooms/\".concat(room_id));_context3.next=12;break;case 9:_context3.prev=9;_context3.t0=_context3[\"catch\"](0);alert(_context3.t0.response.data);case 12:case\"end\":return _context3.stop();}},_callee3,null,[[0,9]]);}));return function handleSubmit(){return _ref4.apply(this,arguments);};}();return/*#__PURE__*/_jsx(\"div\",{className:\"post\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"postWrapper\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"postTop\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"postTopLeft\",children:[/*#__PURE__*/_jsx(Link,{to:\"/profile/\".concat(user._id),children:/*#__PURE__*/_jsx(\"img\",{src:user.profilePicture?PUBLIC_FOLDER+user.profilePicture:PUBLIC_FOLDER+\"/person/noAvatar.png\",alt:\"\",className:\"postProfileImg\"})}),/*#__PURE__*/_jsx(\"span\",{className:\"postUsername\",children:user.username}),/*#__PURE__*/_jsx(\"span\",{className:\"postDate\",children:format(post.createdAt)})]}),/*#__PURE__*/_jsx(\"div\",{className:\"postTopRight\",children:/*#__PURE__*/_jsx(MoreVert,{})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"postCenter\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"postText\",children:post.desc}),post.img?/*#__PURE__*/_jsx(\"img\",{src:PUBLIC_FOLDER+post.img,className:\"postImg\",alt:\"\"}):\"\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"postBottom\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"postBottomLeft\",children:[/*#__PURE__*/_jsx(Favorite,{htmlColor:\"red\",onClick:function onClick(){return handleLike();}}),/*#__PURE__*/_jsxs(\"span\",{className:\"postLikeCounter\",children:[like,\"\\u4EBA\\u304C\\u3044\\u3044\\u306D\\u3092\\u62BC\\u3057\\u307E\\u3057\\u305F\"]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"postBottomRight\",children:loginUser.type?\"\":/*#__PURE__*/_jsx(\"span\",{className:\"postCommentText\",onClick:function onClick(e){return handleSubmit(e);},children:\"\\u30B3\\u30F3\\u30BF\\u30AF\\u30C8\\u3092\\u3068\\u308B\"})})]})]})});}","map":{"version":3,"names":["Favorite","MoreVert","React","useEffect","useState","axios","format","Link","useNavigate","useContext","AuthContext","Post","post","PUBLIC_FOLDER","process","env","REACT_APP_PUBLIC_FOLDER","navigation","likes","length","like","setLike","isLiked","setIsLiked","user","setUser","loginUser","fetchUser","get","userId","response","data","handleLike","put","_id","handleSubmit","createRoom","student_id","teacher_id","studentName","username","teacherName","room","room_id","alert","profilePicture","createdAt","desc","img","type","e"],"sources":["/home/oshimayamato/practice/matching/frontend/src/components/post/Post.jsx"],"sourcesContent":["import { Favorite, MoreVert } from '@mui/icons-material'\nimport React, { useEffect, useState } from 'react'\nimport \"./Post.css\"\nimport axios from \"axios\"\nimport {format} from \"timeago.js\";\nimport { Link, useNavigate } from 'react-router-dom';\nimport { useContext } from 'react';\nimport { AuthContext } from '../../state/AuthContext';\n\nexport default function Post({ post }) {\n  const PUBLIC_FOLDER = process.env.REACT_APP_PUBLIC_FOLDER;\n\n  const navigation = useNavigate();\n  \n\n  const [like, setLike ] = useState(post.likes.length);\n  const [ isLiked, setIsLiked ] = useState(false);\n  const [user, setUser] = useState({});\n\n  //自分\n  const { user: loginUser } = useContext(AuthContext);\n\n  \n  useEffect(() => {\n    const fetchUser = async () => {\n      const response = await axios.get(`/users/teacher/${post.userId}`);\n      // console.log(response)\n      setUser(response.data);\n    };\n    fetchUser();\n  }, []);\n\n  const handleLike = async () => {\n    try {\n      //いいねのAPIを叩いていく\n      await axios.put(`/posts/${post._id}/like`, {userId: loginUser._id});\n    } catch (err) {\n    }\n    setLike(isLiked ? like - 1 : like + 1);\n    setIsLiked(!isLiked);\n  }\n  \n  const handleSubmit = async () => {\n    try {\n\n      const createRoom = {\n        student_id: loginUser._id,\n        teacher_id: user._id,\n        studentName: loginUser.username,\n        teacherName: user.username\n      }\n\n      const room = await axios.post(\"/message/room\", createRoom);\n      const room_id = room.data._id\n\n    \n      navigation(`/rooms/${room_id}`)\n    } catch (err) {\n      alert(err.response.data)\n    }\n  }\n\n  return (\n    <div className='post'>\n      <div className=\"postWrapper\">\n        <div className=\"postTop\">\n          <div className=\"postTopLeft\">\n            <Link to={`/profile/${user._id}`}>\n              <img \n                src={\n                  user.profilePicture \n                  ? PUBLIC_FOLDER + user.profilePicture \n                  : PUBLIC_FOLDER + \"/person/noAvatar.png\"\n                } \n                alt=\"\" className=\"postProfileImg\" \n              />\n            </Link>\n            <span className=\"postUsername\">\n              {user.username}\n            </span>\n            <span className=\"postDate\">\n              {format(post.createdAt)}\n            </span>\n          </div>\n          <div className=\"postTopRight\">\n            <MoreVert />\n          </div>\n        </div>\n        <div className=\"postCenter\">\n          <span className=\"postText\">\n            {post.desc}\n          </span>\n          {post.img \n          ? <img src={ PUBLIC_FOLDER + post.img}  className=\"postImg\" alt=\"\" />\n          :  \"\"}\n        </div>\n        <div className=\"postBottom\">\n          <div className=\"postBottomLeft\">\n            <Favorite htmlColor='red' onClick={\n              () => handleLike()\n            }/>\n            <span className=\"postLikeCounter\">\n              {like}人がいいねを押しました\n            </span>\n          </div>\n          <div className=\"postBottomRight\">\n            { loginUser.type\n              ?  \"\"\n              : <span className=\"postCommentText\" onClick={(e) => handleSubmit(e)}>\n            \n                  コンタクトをとる\n                </span>\n            }\n            \n          </div>\n        </div>\n      </div>\n    </div>\n  )\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}